## 『控制』信号

![](https://mmbiz.qpic.cn/mmbiz_jpg/YriaiaJPb26VO7ubyLo3dSqiaicvxmXoQwLEL9dexTEA2wUn5H8ZWlv7wAy4xRRJv3IIIjLAHbEu3ibzQXEP2TlhTsw/640?wx_fmt=jpeg)

当卫星发射升天后，基本就处于自主驾驶状态了，一般情况下就是按照预设的轨道运行，间歇可能会收到一些来自地面的『控制』信号对运行姿态进行一定的调整。

程序发布其实也是这样，当程序发布到生产环境后，一般就是按照预设的逻辑运行，我们无法直接去干预程序的行为，不过可以通过调整配置参数来动态调整程序的行为。这些配置参数就代表着我们对程序的『控制』信号。

由此可见，配置对程序的运行非常重要，我们需要一种可靠性高、实时性好的手段，从而可以随时对程序『发号施令』。



## 微服务『大脑』

![](https://raw.githubusercontent.com/ppj19891020/picgo-images/master/20201112145640.png)

随着公司微服务的流行，应用和机器数量急剧增长，程序配置也愈加繁杂：各种功能的开关、参数的配置、服务器的地址等等。在这样的大环境下，传统的通过配置文件、数据库等方式已经越来越无法满足我们对配置管理的需求。Apollo配置中心，应运而生！在一定程度上，配置中心就成为了微服务的`大脑`，如何用好这个大脑，让微服务更智能？



## 如何让微服务更『智能』

- 发布开关

  > 发布开关一般用于发布过程中，比如：
  >
  > 1. 有些新功能依赖于其它系统的新接口，而其它系统的发布周期未必和自己的系统一致，可以加个发布开关，默认把该功能关闭，等依赖系统上线后再打开；
  > 2. 有些新功能有较大风险，可以加个发布开关，上线后一旦有问题可以迅速关闭。
  >
  > 需要注意的是，发布开关应该是短暂存在的（1-2 周），一旦功能稳定后需要及时清除开关代码。

-  实验开关

  > 1. A/B 测试
  >
  > 针对特定用户应用新的推荐算法；
  >
  > 针对特定百分比的用户使用新的下单流程；
  >
  > 2. QA 测试
  >
  > 有些重大功能已经对外宣称在某年某日发布
  >
  > 可以事先发到生产环境，只对内部用户打开，测试没问题后按时对全部用户开放

- 运维开关

  > 运维开关通常用于提升系统稳定性，比如：
  >
  > 1. 大促前可以把一些非关键功能关闭来提升系统容量；
  > 2. 当系统出现问题时可以关闭非关键功能来保证核心功能正常工作。
  >
  > 运维开关可能会长期存在，而且一般会涉及多个系统，所以需要提前规划。

-  限流

  > 一般的做法是在网关或 RPC 框架层添加限流逻辑，结合配置中心的动态推送能力实现动态调整限流规则配置。

-  黑白名单

  > 对于一些关键服务，哪怕是在内网环境中一般也会对调用方有所限制，比如：
  >
  > 1. 有敏感信息的服务可以通过配置白名单来限制只有某些应用或 IP 才能调用
  > 2. 某个调用方代码有问题导致超大量调用，对服务稳定性产生了影响，可以通过配置黑名单来暂时屏蔽这个调用方或 IP
  >
  > 一般的做法是在 RPC 框架层添加校验逻辑，结合配置中心的动态推送能力来实现动态调整黑白名单配置。



## 团队『接入』情况

ToD团队、CHD团队、直播团队、丁香医生团队、丁香健康等共计100多个服务接入微服务`大脑`。